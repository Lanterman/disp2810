<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="{% static 'main/css/create_input.css' %}">
    <title>{{ title }}</title>
</head>
<body style="text-align: center; margin-top: 200px;">
    <p id="title">{{ title }}</p>
    <div id="form">
        <form method="post" id="created_form">
            {% csrf_token %}
            <input id="create_input" value="Добавить" type="submit">
        </form>
    </div>
    <p id="show-list-input">
        <a id="link" href="{% url 'input-list' %}">Показать список записей</a>
    </p>
    <div id="new_input"></div>

    {{ last_entry_id|json_script:"last_entry_id" }}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(
            function() {
                let counter = JSON.parse(document.getElementById('last_entry_id').textContent);
                let csrfToken = $("#created_form").children()[0].attributes.value.value;

                // Создать новый блок Input
                $("#create_input").on("click", function(e) {
                    let value = `Input name${counter}`;
                    let newInput = `<p><input value="${value}" readOnly style="font-size: 20px"></p>`
                    $("#new_input").append(newInput);

                    $.ajax({
                        data: {'value': value, 'csrfmiddlewaretoken': csrfToken},
                        type: 'POST',
                        url: `{% url "create-input" %}`,
                        // если успешно, то
                        success: function (response) {
                            counter++;
                        },
                        // если ошибка, то
                        error: function (response) {
                            // предупредим об ошибке
                            console.log(response)
                        }
                    });

                    e.preventDefault();
                });
            }
        );
    </script>
</body>
</html>